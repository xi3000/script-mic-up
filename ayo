--[[
    FULL MOBILE + PC SUPPORT
    WARNING: Only for testing in local/private games
]]

-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

-- Variables
local flying = false
local flySpeed = 5
local flyConnection
local superSpeed = false
local superJump = false
local speedValue = 16
local jumpValue = 50
local moveVector = Vector3.new(0,0,0)
local selectedPlayer = nil

-- Ensure character is loaded
if not LocalPlayer.Character or not LocalPlayer.Character:FindFirstChild("Humanoid") then
    LocalPlayer.CharacterAdded:Wait()
end

-- Functions
local function setSpeed(value)
    speedValue = value
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
        LocalPlayer.Character.Humanoid.WalkSpeed = superSpeed and value*5 or value
    end
end

local function setJump(value)
    jumpValue = value
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
        LocalPlayer.Character.Humanoid.JumpPower = superJump and value*5 or value
    end
end

local function tpToPlayer(targetName)
    local target = Players:FindFirstChild(targetName)
    if target and target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
        LocalPlayer.Character:MoveTo(target.Character.HumanoidRootPart.Position + Vector3.new(0,3,0))
    else
        warn("Không tìm thấy người chơi:", targetName)
    end
end

local function getPlayerList()
    local list = {}
    for _, p in ipairs(Players:GetPlayers()) do
        if p ~= LocalPlayer then
            table.insert(list, p.Name)
        end
    end
    return list
end

-- Fly functions
local function startFly()
    if flying then return end
    flying = true
    local hrp = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if not hrp then return end
    local bg = Instance.new("BodyGyro", hrp)
    bg.P = 9e4
    bg.MaxTorque = Vector3.new(9e9,9e9,9e9)
    bg.CFrame = hrp.CFrame
    local bv = Instance.new("BodyVelocity", hrp)
    bv.MaxForce = Vector3.new(9e9,9e9,9e9)
    bv.Velocity = Vector3.new(0,0,0)
    flyConnection = RunService.RenderStepped:Connect(function()
        local camCF = workspace.CurrentCamera.CFrame
        local dir = moveVector
        if dir.Magnitude > 0 then dir = dir.Unit*flySpeed end
        bv.Velocity = dir
        bg.CFrame = camCF
    end)
end

local function stopFly()
    if not flying then return end
    flying = false
    if flyConnection then flyConnection:Disconnect() end
    local hrp = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if hrp then
        for _, obj in ipairs(hrp:GetChildren()) do
            if obj:IsA("BodyGyro") or obj:IsA("BodyVelocity") then obj:Destroy() end
        end
    end
end

-- Create UI
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/lxte/lates-lib/main/Main.lua"))()
local Window = Library:CreateWindow({
    Title = "Player Hacks",
    Theme = "Dark",
    Size = UDim2.fromOffset(600,400),
    Transparency = 0.2,
    Blurring = true,
    MinimizeKeybind = Enum.KeyCode.LeftAlt,
})
Window.Frame.Parent = PlayerGui
Window:SetTheme({
    Dark = {
        Primary = Color3.fromRGB(30,30,30),
        Secondary = Color3.fromRGB(35,35,35),
        Component = Color3.fromRGB(40,40,40),
        Interactables = Color3.fromRGB(45,45,45),
        Tab = Color3.fromRGB(200,200,200),
        Title = Color3.fromRGB(240,240,240),
        Description = Color3.fromRGB(200,200,200),
        Shadow = Color3.fromRGB(0,0,0),
        Outline = Color3.fromRGB(40,40,40),
        Icon = Color3.fromRGB(220,220,220)
    }
})
Window:AddTabSection({Name="Main",Order=1})
Window:AddTabSection({Name="Settings",Order=2})
local Main = Window:AddTab({Title="Main Controls",Section="Main",Icon="rbxassetid://11963373994"})

-- Speed & Jump
Window:AddSlider({Title="Walk Speed",Description="Chỉnh tốc độ chạy (max 100)",Tab=Main,MaxValue=100,Callback=setSpeed})
Window:AddButton({Title="Super Speed x5",Description="Chạy nhanh gấp 5 lần",Tab=Main,Callback=function() superSpeed=true setSpeed(speedValue) end})
Window:AddSlider({Title="Jump Power",Description="Chỉnh độ cao nhảy (max 100)",Tab=Main,MaxValue=100,Callback=setJump})
Window:AddButton({Title="Super Jump x5",Description="Nhảy cao gấp 5 lần",Tab=Main,Callback=function() superJump=true setJump(jumpValue) end})

-- Fly
Window:AddToggle({Title="Fly",Description="Bật/tắt bay",Tab=Main,Callback=function(state) if state then startFly() else stopFly() end end})
Window:AddSlider({Title="Fly Speed",Description="Tốc độ bay",Tab=Main,MaxValue=20,Callback=function(value) flySpeed=value end})

-- Teleport
local playerDropdown = Window:AddDropdown({Title="Chọn người chơi",Description="Chọn tên để teleport",Tab=Main,Options=getPlayerList(),Callback=function(Name) selectedPlayer=Name end})
Window:AddButton({Title="Teleport",Description="Dịch chuyển đến người chơi đã chọn",Tab=Main,Callback=function() if selectedPlayer then tpToPlayer(selectedPlayer) else warn("Chưa chọn người chơi!") end end})
Window:AddButton({Title="Refresh Players",Description="Cập nhật danh sách người chơi",Tab=Main,Callback=function() playerDropdown:SetOptions(getPlayerList()) Window:Notify({Title="Refresh",Description="Danh sách đã cập nhật",Duration=3}) end})

-- Mobile Fly buttons
local screenGui = Instance.new("ScreenGui", PlayerGui)
screenGui.Name = "FlyControls"

local function createButton(text,pos)
    local btn = Instance.new("TextButton",screenGui)
    btn.Text=text
    btn.Size=UDim2.new(0,60,0,60)
    btn.Position=pos
    btn.BackgroundTransparency=0.5
    return btn
end

local upButton = createButton("↑",UDim2.new(0,50,1,-150))
local downButton = createButton("↓",UDim2.new(0,50,1,-80))
local leftButton = createButton("←",UDim2.new(0,0,1,-115))
local rightButton = createButton("→",UDim2.new(0,100,1,-115))

-- Touch hold movement
local function touchHold(button,dir)
    local holding = false
    button.InputBegan:Connect(function(input)
        if input.UserInputType==Enum.UserInputType.Touch or input.UserInputType==Enum.UserInputType.MouseButton1 then
            holding=true
            moveVector = moveVector + dir
        end
    end)
    button.InputEnded:Connect(function(input)
        if input.UserInputType==Enum.UserInputType.Touch or input.UserInputType==Enum.UserInputType.MouseButton1 then
            holding=false
            moveVector = moveVector - dir
        end
    end)
end

touchHold(upButton,Vector3.new(0,1,0))
touchHold(downButton,Vector3.new(0,-1,0))
touchHold(leftButton,workspace.CurrentCamera.CFrame.RightVector*-1)
touchHold(rightButton,workspace.CurrentCamera.CFrame.RightVector)

-- Menu toggle button for mobile
local toggleMenuButton = Instance.new("TextButton",screenGui)
toggleMenuButton.Text="Menu"
toggleMenuButton.Size=UDim2.new(0,80,0,40)
toggleMenuButton.Position=UDim2.new(1,-100,0,50)
toggleMenuButton.BackgroundTransparency=0.5
toggleMenuButton.MouseButton1Click:Connect(function()
    Window:SetVisibility(not Window:GetVisibility())
end)

Window:Notify({Title="UI Loaded!",Description="Hỗ trợ Mobile & PC. Dùng nút Menu để ẩn/hiện UI",Duration=5})
