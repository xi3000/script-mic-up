--[[
    MINI FLOAT UI ULTIMATE - 1 Click Full Power
]]

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

-- Variables
local flying=false
local flySpeed=20
local superSpeed=true
local superJump=true
local speedValue=16
local jumpValue=50
local moveVector=Vector3.new(0,0,0)
local selectedPlayer=nil

if not LocalPlayer.Character or not LocalPlayer.Character:FindFirstChild("Humanoid") then
    LocalPlayer.CharacterAdded:Wait()
end

-- Functions
local function setSpeed(value)
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
        LocalPlayer.Character.Humanoid.WalkSpeed = superSpeed and value*5 or value
    end
end

local function setJump(value)
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
        LocalPlayer.Character.Humanoid.JumpPower = superJump and value*5 or value
    end
end

local function tpToPlayer(name)
    local target=Players:FindFirstChild(name)
    if target and target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
        LocalPlayer.Character:MoveTo(target.Character.HumanoidRootPart.Position+Vector3.new(0,3,0))
    else
        warn("Không tìm thấy:",name)
    end
end

local function getPlayerList()
    local list={}
    for _,p in ipairs(Players:GetPlayers()) do
        if p~=LocalPlayer then table.insert(list,p.Name) end
    end
    return list
end

-- Fly
local flyConnection
local function startFly()
    if flying then return end
    flying=true
    local hrp=LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if not hrp then return end
    local bg=Instance.new("BodyGyro",hrp)
    bg.P=9e4
    bg.MaxTorque=Vector3.new(9e9,9e9,9e9)
    bg.CFrame=hrp.CFrame
    local bv=Instance.new("BodyVelocity",hrp)
    bv.MaxForce=Vector3.new(9e9,9e9,9e9)
    bv.Velocity=Vector3.new(0,0,0)
    flyConnection=RunService.RenderStepped:Connect(function()
        local camCF=workspace.CurrentCamera.CFrame
        local dir=moveVector
        if dir.Magnitude>0 then dir=dir.Unit*flySpeed end
        bv.Velocity=dir
        bg.CFrame=camCF
    end)
end

local function stopFly()
    if not flying then return end
    flying=false
    if flyConnection then flyConnection:Disconnect() end
    local hrp=LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if hrp then
        for _,obj in ipairs(hrp:GetChildren()) do
            if obj:IsA("BodyGyro") or obj:IsA("BodyVelocity") then obj:Destroy() end
        end
    end
end

-- Create Float UI
local screenGui=Instance.new("ScreenGui",PlayerGui)
screenGui.Name="MiniFloatUI"

local floatBtn=Instance.new("TextButton",screenGui)
floatBtn.Size=UDim2.new(0,60,0,60)
floatBtn.Position=UDim2.new(0,50,0,50)
floatBtn.BackgroundColor3=Color3.fromRGB(0,0,0)
floatBtn.BackgroundTransparency=0.4
floatBtn.Text="Menu"
floatBtn.TextColor3=Color3.fromRGB(255,255,255)
floatBtn.TextScaled=true
floatBtn.AutoButtonColor=true
floatBtn.ZIndex=10

-- Main Panel
local panel=Instance.new("Frame",screenGui)
panel.Size=UDim2.new(0,300,0,400)
panel.Position=UDim2.new(0,50,0,120)
panel.BackgroundColor3=Color3.fromRGB(20,20,20)
panel.BackgroundTransparency=0.2
panel.Visible=false
panel.BorderSizePixel=0
panel.ZIndex=9

local title=Instance.new("TextLabel",panel)
title.Size=UDim2.new(1,0,0,30)
title.BackgroundColor3=Color3.fromRGB(30,30,30)
title.Text="Player Hacks ULTIMATE"
title.TextColor3=Color3.fromRGB(255,255,255)
title.TextScaled=true
title.Font=Enum.Font.SourceSansBold

local closeBtn=Instance.new("TextButton",panel)
closeBtn.Size=UDim2.new(0,30,0,30)
closeBtn.Position=UDim2.new(1,-35,0,0)
closeBtn.Text="X"
closeBtn.TextColor3=Color3.fromRGB(255,255,255)
closeBtn.BackgroundColor3=Color3.fromRGB(150,0,0)
closeBtn.MouseButton1Click:Connect(function() panel.Visible=false end)

local function createBtn(parent,pos,text,color,callback)
    local btn=Instance.new("TextButton",parent)
    btn.Size=UDim2.new(0,120,0,30)
    btn.Position=pos
    btn.Text=text
    btn.BackgroundColor3=color
    btn.TextColor3=Color3.fromRGB(255,255,255)
    btn.TextScaled=false
    btn.MouseButton1Click:Connect(callback)
    return btn
end

local function createSlider(parent,pos,labelText,minVal,maxVal,default,callback)
    local lbl=Instance.new("TextLabel",parent)
    lbl.Size=UDim2.new(0,250,0,20)
    lbl.Position=pos
    lbl.Text=labelText.." "..default
    lbl.TextColor3=Color3.fromRGB(255,255,255)
    lbl.BackgroundTransparency=1
    lbl.TextScaled=false

    local slider=Instance.new("TextButton",parent)
    slider.Size=UDim2.new(0,250,0,20)
    slider.Position=pos+UDim2.new(0,0,0,20)
    slider.BackgroundColor3=Color3.fromRGB(80,80,80)
    slider.Text=""
    local dragging=false
    local function update(input)
        local posX=input.Position.X-slider.AbsolutePosition.X
        posX=math.clamp(posX,0,slider.AbsoluteSize.X)
        local val=minVal+((posX/slider.AbsoluteSize.X)*(maxVal-minVal))
        val=math.floor(val)
        lbl.Text=labelText.." "..val
        callback(val)
    end
    slider.InputBegan:Connect(function(input)
        if input.UserInputType==Enum.UserInputType.MouseButton1 or input.UserInputType==Enum.UserInputType.Touch then
            dragging=true
            update(input)
        end
    end)
    slider.InputChanged:Connect(function(input)
        if dragging then update(input) end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType==Enum.UserInputType.MouseMovement or input.UserInputType==Enum.UserInputType.Touch) then
            update(input)
        end
    end)
    slider.InputEnded:Connect(function(input)
        dragging=false
    end)
end

-- Sliders
createSlider(panel,UDim2.new(0,25,0,50),"Speed",1,100,speedValue,setSpeed)
createSlider(panel,UDim2.new(0,25,0,100),"Jump",1,100,jumpValue,setJump)
createSlider(panel,UDim2.new(0,25,0,150),"Fly Speed",1,50,flySpeed,function(val) flySpeed=val end)

-- Buttons
createBtn(panel,UDim2.new(0,25,0,200),"Fly: OFF",Color3.fromRGB(0,0,150),function()
    if flying then stopFly() else startFly() end
end)
createBtn(panel,UDim2.new(0,150,0,200),"1 Click FULL POWER",Color3.fromRGB(255,0,0),function()
    superSpeed=true
    superJump=true
    speedValue=100
    jumpValue=100
    flySpeed=20
    setSpeed(speedValue)
    setJump(jumpValue)
    if not flying then startFly() end
end)

-- TP & Refresh
local playerList=getPlayerList()
local dropdown=Instance.new("TextButton",panel)
dropdown.Size=UDim2.new(0,250,0,30)
dropdown.Position=UDim2.new(0,25,0,250)
dropdown.Text="Select Player"
dropdown.BackgroundColor3=Color3.fromRGB(70,70,70)
dropdown.TextColor3=Color3.fromRGB(255,255,255)
dropdown.MouseButton1Click:Connect(function()
    selectedPlayer=playerList[math.random(1,#playerList)]
    dropdown.Text="TP -> "..selectedPlayer
end)

createBtn(panel,UDim2.new(0,25,0,290),"Teleport",Color3.fromRGB(0,150,150),function()
    if selectedPlayer then tpToPlayer(selectedPlayer) end
end)
createBtn(panel,UDim2.new(0,150,0,290),"Refresh",Color3.fromRGB(150,150,0),function()
    playerList=getPlayerList()
end)

-- Mobile Fly Buttons
local function createMobileBtn(text,pos,dir)
    local btn=Instance.new("TextButton",screenGui)
    btn.Text=text
    btn.Size=UDim2.new(0,50,0,50)
    btn.Position=pos
    btn.BackgroundTransparency=0.5
    btn.MouseButton1Down:Connect(function() moveVector=moveVector+dir end)
    btn.MouseButton1Up:Connect(function() moveVector=moveVector-dir end)
end

createMobileBtn("↑",UDim2.new(0,50,1,-150),Vector3.new(0,1,0))
createMobileBtn("↓",UDim2.new(0,50,1,-90),Vector3.new(0,-1,0))
createMobileBtn("←",UDim2.new(0,0,1,-120),workspace.CurrentCamera.CFrame.RightVector*-1)
createMobileBtn("→",UDim2.new(0,100,1,-120),workspace.CurrentCamera.CFrame.RightVector)

-- Float button toggle panel
floatBtn.MouseButton1Click:Connect(function()
    panel.Visible=not panel.Visible
end)

-- Drag float button (mobile friendly)
local dragging=false
local dragInput
local dragStart
local startPos
floatBtn.InputBegan:Connect(function(input)
    if input.UserInputType==Enum.UserInputType.Touch or input.UserInputType==Enum.UserInputType.MouseButton1 then
        dragging=true
        dragStart=input.Position
        startPos=floatBtn.Position
        input.Changed:Connect(function()
            if input.UserInputState==Enum.UserInputState.End then dragging=false end
        end)
    end
end)
floatBtn.InputChanged:Connect(function(input)
    if input.UserInputType==Enum.UserInputType.Touch or input.UserInputType==Enum.UserInputType.MouseMovement then
        dragInput=input
    end
end)
RunService.RenderStepped:Connect(function()
    if dragging and dragInput then
        local delta=dragInput.Position-dragStart
        floatBtn.Position=startPos+UDim2.new(0,delta.X,0,delta.Y)
    end
end)
